<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“°</text></svg>" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>News Aggregator - Modern</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Axios for API calls -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
      :root {
        --background: 0 0% 100%;
        --foreground: 222.2 84% 4.9%;
        --card: 0 0% 100%;
        --card-foreground: 222.2 84% 4.9%;
        --popover: 0 0% 100%;
        --popover-foreground: 222.2 84% 4.9%;
        --primary: 221.2 83.2% 53.3%;
        --primary-foreground: 210 40% 98%;
        --secondary: 210 40% 96%;
        --secondary-foreground: 222.2 84% 4.9%;
        --muted: 210 40% 96%;
        --muted-foreground: 215.4 16.3% 46.9%;
        --accent: 210 40% 96%;
        --accent-foreground: 222.2 84% 4.9%;
        --destructive: 0 84.2% 60.2%;
        --destructive-foreground: 210 40% 98%;
        --border: 214.3 31.8% 91.4%;
        --input: 214.3 31.8% 91.4%;
        --ring: 221.2 83.2% 53.3%;
        --radius: 0.75rem;
      }

      body {
        background: hsl(var(--background));
        color: hsl(var(--foreground));
      }

      .news-gradient {
        background: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(var(--primary) / 0.8) 100%);
      }

      .news-card-hover {
        transition: all 0.3s ease;
      }

      .news-card-hover:hover {
        transform: translateY(-4px);
      }

      .animate-spin {
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }

      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
    </style>
    
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              border: "hsl(var(--border))",
              input: "hsl(var(--input))",
              ring: "hsl(var(--ring))",
              background: "hsl(var(--background))",
              foreground: "hsl(var(--foreground))",
              primary: {
                DEFAULT: "hsl(var(--primary))",
                foreground: "hsl(var(--primary-foreground))",
              },
              secondary: {
                DEFAULT: "hsl(var(--secondary))",
                foreground: "hsl(var(--secondary-foreground))",
              },
              destructive: {
                DEFAULT: "hsl(var(--destructive))",
                foreground: "hsl(var(--destructive-foreground))",
              },
              muted: {
                DEFAULT: "hsl(var(--muted))",
                foreground: "hsl(var(--muted-foreground))",
              },
              accent: {
                DEFAULT: "hsl(var(--accent))",
                foreground: "hsl(var(--accent-foreground))",
              },
              popover: {
                DEFAULT: "hsl(var(--popover))",
                foreground: "hsl(var(--popover-foreground))",
              },
              card: {
                DEFAULT: "hsl(var(--card))",
                foreground: "hsl(var(--card-foreground))",
              },
            },
            borderRadius: {
              lg: "var(--radius)",
              md: "calc(var(--radius) - 2px)",
              sm: "calc(var(--radius) - 4px)",
            }
          }
        }
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    
    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      // API service
      const API_BASE_URL = 'http://localhost:8082/api/v1';
      
      const newsApi = {
        getAllNews: async () => {
          const response = await axios.get(`${API_BASE_URL}/news`);
          return response.data;
        },
        getCategories: async () => {
          const response = await axios.get(`${API_BASE_URL}/categories`);
          return response.data;
        },
        searchNews: async (query) => {
          const response = await axios.get(`${API_BASE_URL}/search?q=${encodeURIComponent(query)}`);
          return response.data;
        }
      };

      // Utility functions
      const formatTimeAgo = (dateString) => {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now.getTime() - date.getTime();
        const diffMins = Math.floor(diffMs / (1000 * 60));
        const diffHours = Math.floor(diffMins / 60);
        const diffDays = Math.floor(diffHours / 24);

        if (diffMins < 60) {
          return `${diffMins}m ago`;
        } else if (diffHours < 24) {
          return `${diffHours}h ago`;
        } else {
          return `${diffDays}d ago`;
        }
      };

      const getCategoryIcon = (category) => {
        const icons = {
          technology: 'ðŸ’»',
          business: 'ðŸ’¼',
          sports: 'âš½',
          politics: 'ðŸ›ï¸',
          health: 'ðŸ¥',
          science: 'ðŸ”¬',
          entertainment: 'ðŸŽ¬',
          world: 'ðŸŒ',
          general: 'ðŸ“°',
        };
        return icons[category] || icons.general;
      };

      const getCategoryColor = (category) => {
        const colors = {
          technology: 'bg-blue-500',
          business: 'bg-green-500',
          sports: 'bg-orange-500',
          politics: 'bg-red-500',
          health: 'bg-purple-500',
          science: 'bg-cyan-500',
          entertainment: 'bg-pink-500',
          world: 'bg-emerald-500',
          general: 'bg-gray-500',
        };
        return colors[category] || colors.general;
      };

      // Components
      const Header = () => (
        <header className="news-gradient text-white py-12 mb-8">
          <div className="container mx-auto px-4 text-center">
            <div className="flex items-center justify-center gap-3 mb-4">
              <svg className="h-8 w-8" fill="currentColor" viewBox="0 0 24 24">
                <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
              </svg>
              <h1 className="text-4xl md:text-5xl font-bold">
                News Aggregator
              </h1>
            </div>
            <p className="text-lg md:text-xl opacity-90 mb-6 max-w-2xl mx-auto">
              Stay updated with the latest news from around the world. 
              Discover, search, and explore stories that matter to you.
            </p>
            <div className="flex items-center justify-center gap-4 text-sm opacity-80">
              <span>Built with React & Go</span>
              <span>â€¢</span>
              <span>Modern UI</span>
            </div>
          </div>
        </header>
      );

      const SearchBar = ({ onSearch, onClear, loading }) => {
        const [query, setQuery] = useState('');

        const handleSubmit = (e) => {
          e.preventDefault();
          if (query.trim()) {
            onSearch(query.trim());
          }
        };

        return (
          <div className="w-full max-w-4xl mx-auto bg-white rounded-lg p-4 shadow-sm border">
            <form onSubmit={handleSubmit} className="flex gap-2">
              <div className="relative flex-1">
                <svg className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="11" cy="11" r="8"/>
                  <path d="m21 21-4.35-4.35"/>
                </svg>
                <input
                  type="text"
                  value={query}
                  onChange={(e) => setQuery(e.target.value)}
                  placeholder="Search news articles..."
                  className="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  disabled={loading}
                />
              </div>
              <button 
                type="submit" 
                className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                disabled={loading || !query.trim()}
              >
                {loading ? (
                  <svg className="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"/>
                    <path className="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                  </svg>
                ) : (
                  <svg className="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                  </svg>
                )}
                <span className="hidden sm:inline">Search</span>
              </button>
            </form>
            <div className="flex justify-center mt-3">
              <button 
                onClick={onClear}
                className="px-4 py-2 text-sm border border-gray-200 rounded-full hover:bg-gray-50 transition-colors"
                disabled={loading}
              >
                ðŸ“° Show All News
              </button>
            </div>
          </div>
        );
      };

      const CategoryFilter = ({ categories, selectedCategory, onCategorySelect, loading }) => (
        <div className="w-full max-w-6xl mx-auto bg-white rounded-lg p-4 shadow-sm border">
          <div className="flex flex-wrap gap-2 justify-center">
            <button
              className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${
                selectedCategory === '' 
                  ? 'bg-blue-600 text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-blue-100'
              }`}
              onClick={() => onCategorySelect('')}
              disabled={loading}
            >
              ðŸ“° All
            </button>
            {categories.map((category) => (
              <button
                key={category}
                className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${
                  selectedCategory === category 
                    ? 'bg-blue-600 text-white' 
                    : 'bg-gray-100 text-gray-700 hover:bg-blue-100'
                }`}
                onClick={() => onCategorySelect(category)}
                disabled={loading}
              >
                {getCategoryIcon(category)} {category.charAt(0).toUpperCase() + category.slice(1)}
              </button>
            ))}
          </div>
        </div>
      );

      const StatsBar = ({ totalArticles, currentFilter, searchQuery, loading }) => {
        const getStatsMessage = () => {
          if (loading) return "Loading articles...";
          if (searchQuery) return `Found ${totalArticles} articles matching "${searchQuery}"`;
          if (currentFilter) return `Showing ${totalArticles} ${currentFilter} articles`;
          return `Showing ${totalArticles} articles`;
        };

        return (
          <div className="w-full max-w-4xl mx-auto bg-white rounded-lg p-3 shadow-sm border">
            <div className="flex items-center justify-center gap-2 text-blue-600 font-medium">
              <svg className="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              <span>{getStatsMessage()}</span>
            </div>
          </div>
        );
      };

      const NewsCard = ({ news }) => {
        const handleClick = () => {
          window.open(news.url, '_blank', 'noopener,noreferrer');
        };

        return (
          <div 
            className="bg-white rounded-lg shadow-sm border news-card-hover cursor-pointer overflow-hidden"
            onClick={handleClick}
          >
            {/* Header */}
            <div className="news-gradient h-32 flex items-center justify-center text-white relative">
              <div className="text-center">
                <div className="text-2xl mb-1">{getCategoryIcon(news.category)}</div>
                <div className="text-sm font-medium opacity-90">{news.source}</div>
              </div>
            </div>

            {/* Content */}
            <div className="p-4">
              {/* Category */}
              <div className="mb-3">
                <span className={`inline-block px-2 py-1 rounded-full text-white text-xs font-semibold ${getCategoryColor(news.category)}`}>
                  {news.category.toUpperCase()}
                </span>
              </div>

              {/* Title */}
              <h3 className="text-lg font-semibold mb-2 text-gray-900 line-clamp-2 group-hover:text-blue-600 transition-colors">
                {news.title}
              </h3>

              {/* Summary */}
              <p className="text-gray-600 text-sm mb-3 line-clamp-3">
                {news.summary}
              </p>

              {/* Tags */}
              {news.tags && news.tags.length > 0 && (
                <div className="flex flex-wrap gap-1 mb-3">
                  {news.tags.slice(0, 3).map((tag, index) => (
                    <span
                      key={index}
                      className="inline-block bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs"
                    >
                      #{tag}
                    </span>
                  ))}
                  {news.tags.length > 3 && (
                    <span className="inline-block bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs">
                      +{news.tags.length - 3}
                    </span>
                  )}
                </div>
              )}
            </div>

            {/* Footer */}
            <div className="px-4 pb-4 flex justify-between items-center text-xs text-gray-500 border-t border-gray-100 pt-3">
              <div className="flex items-center gap-1">
                <svg className="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span className="font-medium text-blue-600">
                  {news.author || 'Unknown'}
                </span>
              </div>
              <div className="flex items-center gap-1">
                <svg className="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12,6 12,12 16,14"/>
                </svg>
                <span>{formatTimeAgo(news.published_at)}</span>
              </div>
            </div>
          </div>
        );
      };

      const LoadingSpinner = ({ message = "Loading news articles..." }) => (
        <div className="flex flex-col items-center justify-center p-8 text-center">
          <svg className="animate-spin h-8 w-8 text-blue-600 mb-4" fill="none" viewBox="0 0 24 24">
            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"/>
            <path className="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
          </svg>
          <p className="text-gray-600">{message}</p>
        </div>
      );

      const ErrorMessage = ({ message, onRetry }) => (
        <div className="bg-white rounded-lg p-8 shadow-sm border text-center max-w-md mx-auto">
          <svg className="h-12 w-12 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
          </svg>
          <h3 className="text-lg font-semibold text-gray-900 mb-2">Something went wrong</h3>
          <p className="text-gray-600 text-sm mb-4">{message}</p>
          {onRetry && (
            <button
              onClick={onRetry}
              className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 mx-auto"
            >
              <svg className="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
              Try Again
            </button>
          )}
        </div>
      );

      // Main App
      const App = () => {
        const [news, setNews] = useState([]);
        const [categories, setCategories] = useState([]);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);
        const [selectedCategory, setSelectedCategory] = useState('');
        const [searchQuery, setSearchQuery] = useState('');

        const filteredNews = useMemo(() => {
          if (selectedCategory) {
            return news.filter(item => item.category === selectedCategory);
          }
          return news;
        }, [news, selectedCategory]);

        useEffect(() => {
          loadInitialData();
        }, []);

        const loadInitialData = async () => {
          try {
            setLoading(true);
            setError(null);

            const [newsResponse, categoriesResponse] = await Promise.all([
              newsApi.getAllNews(),
              newsApi.getCategories()
            ]);

            setNews(newsResponse.data);
            setCategories(categoriesResponse.data);
          } catch (err) {
            console.error('Error loading data:', err);
            setError('Failed to load news. Please check if the news server is running on http://localhost:8082');
          } finally {
            setLoading(false);
          }
        };

        const handleSearch = async (query) => {
          try {
            setLoading(true);
            setError(null);
            setSelectedCategory('');

            const searchResponse = await newsApi.searchNews(query);
            setNews(searchResponse.data);
            setSearchQuery(query);
          } catch (err) {
            console.error('Error searching news:', err);
            setError('Failed to search news. Please try again.');
          } finally {
            setLoading(false);
          }
        };

        const handleClearSearch = () => {
          setSearchQuery('');
          setSelectedCategory('');
          loadInitialData();
        };

        const handleCategorySelect = (category) => {
          setSelectedCategory(category);
          if (searchQuery) {
            setSearchQuery('');
            loadInitialData();
          }
        };

        if (loading && news.length === 0) {
          return (
            <div className="min-h-screen bg-gray-50">
              <Header />
              <div className="container mx-auto px-4">
                <LoadingSpinner />
              </div>
            </div>
          );
        }

        if (error && news.length === 0) {
          return (
            <div className="min-h-screen bg-gray-50">
              <Header />
              <div className="container mx-auto px-4">
                <ErrorMessage message={error} onRetry={loadInitialData} />
              </div>
            </div>
          );
        }

        return (
          <div className="min-h-screen bg-gray-50">
            <Header />
            
            <main className="container mx-auto px-4 pb-8">
              <div className="space-y-6">
                <SearchBar
                  onSearch={handleSearch}
                  onClear={handleClearSearch}
                  loading={loading}
                />

                {!searchQuery && (
                  <CategoryFilter
                    categories={categories}
                    selectedCategory={selectedCategory}
                    onCategorySelect={handleCategorySelect}
                    loading={loading}
                  />
                )}

                <StatsBar
                  totalArticles={filteredNews.length}
                  currentFilter={selectedCategory}
                  searchQuery={searchQuery}
                  loading={loading}
                />

                {loading && <LoadingSpinner message="Loading..." />}
                
                {!loading && filteredNews.length === 0 && (
                  <div className="text-center py-12">
                    <svg className="h-16 w-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h3 className="text-xl font-semibold text-gray-900 mb-2">No articles found</h3>
                    <p className="text-gray-600">Try adjusting your search or filter criteria</p>
                  </div>
                )}
                
                {!loading && filteredNews.length > 0 && (
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {filteredNews.map((article) => (
                      <NewsCard key={article.id} news={article} />
                    ))}
                  </div>
                )}
              </div>
            </main>

            <footer className="border-t bg-white py-6 mt-12">
              <div className="container mx-auto px-4 text-center text-sm text-gray-600">
                <p>Â© 2024 News Aggregator - Modern React Interface</p>
                <p className="mt-1">
                  API: <a 
                    href="http://localhost:8082/health" 
                    target="_blank" 
                    rel="noopener noreferrer"
                    className="text-blue-600 hover:underline"
                  >
                    http://localhost:8082
                  </a>
                </p>
              </div>
            </footer>
          </div>
        );
      };

      // Render the app
      ReactDOM.render(<App />, document.getElementById('root'));
    </script>
  </body>
</html>
